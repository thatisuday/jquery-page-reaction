{"version":3,"sources":["plugin.js"],"names":["$","undefined","window","io","Error","getPickData","$elem","attrs","data","forEach","attr","value","socketEmit","socket","callback","emit","inviewPending","setInterval","_inviewPending","splice","length","map","o","fn","pageReact","options","extend","on","once","pickData","config","this","each","$this","dispatchEvent","event","sessionId","dispatchBulkEvent","push","bindDomEvents","document","ready","one","pageReactConfig","jQuery"],"mappings":"AAAA,cAEA,SAAAA,GAGA,GAAAC,QAAAC,OAAAC,IAAA,MAAAD,OAAAC,GACA,KAAA,IAAAC,OAAA,sEAOA,IAAAC,GAAA,SAAAC,EAAAC,GACA,GAAAC,KAUA,OARAD,GAAAE,QAAA,SAAAC,GACA,GAAAC,GAAAL,EAAAE,KAAAE,EAEAC,KACAH,EAAAE,GAAAC,KAIAH,GAIAI,EAAA,SAAAC,EAAAL,EAAAM,GACAD,EAAAE,KAAA,cAAAP,GACAM,GAAAA,EAAAN,IAIAQ,IACAC,aAAA,WACA,GAAAC,GAAAF,EAAAG,OAAA,EAAAH,EAAAI,OAEA,IAAAF,EAAAE,OAAA,EAAA,CAEA,GAAAZ,GAAAU,EAAAG,IAAA,SAAAC,GACA,MAAAA,GAAAd,OAIAK,EAAAK,EAAA,GAAAL,MAGAD,GAAAC,EAAAL,EAAA,MAGAU,EAAAT,QAAA,SAAAa,GACAA,EAAAR,SAAAQ,EAAAd,UAGA,KAMAR,EAAAuB,GAAAC,UAAA,SAAAC,GAGA,GAAAA,GAAAzB,EAAA0B,WACAC,GAAA,QACAC,MAAA,EACAC,aACA7B,EAAAuB,GAAAC,UAAAM,OAAAL,EAKA,IAAAxB,QAAAwB,EAAAZ,QAAA,MAAAY,EAAAZ,OACA,KAAA,IAAAT,OAAA,8DAAAqB,EAAAE,GA6FA,OAtFAI,MAAAC,KAAA,WAGA,GAAAC,GAAAjC,EAAA+B,MAKAG,EAAA,SAAAC,EAAArB,GACAF,EAAAa,EAAAZ,QACAsB,MAAAA,EACAC,UAAAX,EAAAW,UACAP,SAAAxB,EAAA4B,EAAAR,EAAAI,WACAf,IAIAuB,EAAA,SAAAF,EAAArB,GACAE,EAAAsB,MACAzB,OAAAY,EAAAZ,OACAL,MACA2B,MAAAA,EACAC,UAAAX,EAAAW,UACAP,SAAAxB,EAAA4B,EAAAR,EAAAI,WAEAf,SAAAA,KAKAyB,EAAA,SAAAJ,EAAArB,GACA,SAAAqB,EACAnC,EAAAwC,UAAAC,MAAA,WACA3B,EAAAqB,KAIA,GAAAV,EAAAG,KACAK,EAAAS,IAAAP,EAAA,WACArB,EAAAqB,KAIAF,EAAAN,GAAAQ,EAAA,WACArB,EAAAqB,KASA,UAAAV,EAAAE,GACAY,EAAA,QAAA,SAAAJ,GACAD,EAAAC,EAAA,SAAA3B,GACAiB,EAAAX,UAAAW,EAAAX,SAAAmB,EAAAzB,OAKA,cAAAiB,EAAAE,GACAY,EAAA,aAAA,SAAAJ,GACAD,EAAAC,EAAA,SAAA3B,GACAiB,EAAAX,UAAAW,EAAAX,SAAAmB,EAAAzB,OAKA,UAAAiB,EAAAE,GACAY,EAAA,SAAA,SAAAJ,GACAE,EAAAF,EAAA,SAAA3B,GACAiB,EAAAX,UAAAW,EAAAX,SAAAmB,EAAAzB,OAKA,SAAAiB,EAAAE,IACAY,EAAA,QAAA,SAAAJ,GACAD,EAAAC,EAAA,SAAA3B,GACAiB,EAAAX,UAAAW,EAAAX,SAAAmB,EAAAzB,SAMAuB,MAKA/B,EAAAuB,GAAAC,UAAAM,QACAjB,OAAA,MAEAb,EAAAuB,GAAAoB,gBAAA,SAAAlB,GACAzB,EAAA0B,OAAA1B,EAAAuB,GAAAC,UAAAM,OAAAL,KAGAmB","file":"plugin.min.js","sourcesContent":["'use strict';\r\n\r\n(function($){\r\n\r\n\t// check if socket.io client library is loaded\r\n\tif(window.io == undefined || window.io == null){\r\n\t\tthrow new Error('socket-io client library is missing!!! page-reaction will not work!');\r\n\t\treturn;\r\n\t}\r\n\r\n\t/*****************************************************************/\r\n\r\n\t// get data from html data attributes\r\n\tvar getPickData = function($elem, attrs){\r\n\t\tvar data = {};\r\n\r\n\t\tattrs.forEach(function(attr){\r\n\t\t\tvar value = $elem.data(attr);\r\n\t\t\t\r\n\t\t\tif(value){\r\n\t\t\t\tdata[attr] = value;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t// emit interaction event to socket server\r\n\tvar socketEmit = function(socket, data, callback){\r\n\t\tsocket.emit('interaction', data);\r\n\t\tif(callback) callback(data);\r\n\t}\r\n\r\n\t// emit inview event every second to trim down traffic\r\n\tvar inviewPending = [];\r\n\tsetInterval(function(){\r\n\t\tvar _inviewPending = inviewPending.splice(0, inviewPending.length);\r\n\r\n\t\tif(_inviewPending.length > 0){\r\n\t\t\t// get bulk data\r\n\t\t\tvar data = _inviewPending.map(function(o){\r\n\t\t\t\treturn o.data;\r\n\t\t\t});\r\n\r\n\t\t\t// get a socket\r\n\t\t\tvar socket = _inviewPending[0].socket;\r\n\t\t\t\r\n\t\t\t// emit socket event with bulk data\r\n\t\t\tsocketEmit(socket, data, null);\r\n\t\t\t\r\n\t\t\t// call all associated callbacks\r\n\t\t\t_inviewPending.forEach(function(o){\r\n\t\t\t\to.callback(o.data);\r\n\t\t\t});\r\n\t\t}\r\n\t}, 1000);\r\n\r\n\r\n\t/*****************************************************************/\r\n\r\n\t// inject page-reaction plugin to jQuery\r\n\t$.fn.pageReact = function(options){\r\n\r\n\t\t// set options\r\n\t\tvar options = $.extend({}, {\r\n\t\t\ton \t\t\t:  'click',\r\n\t\t\tonce \t\t:  true,\r\n\t\t\tpickData \t: [],\r\n\t\t}, $.fn.pageReact.config, options);\r\n\r\n\t\t/*****************************************/\r\n\r\n\t\t// check if web-socket connection is injected\r\n\t\tif(options.socket == undefined || options.socket == null){\r\n\t\t\tthrow new Error('socket connection is missing in options provided for event ' + options.on);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t/*****************************************/\r\n\r\n\t\t// loop over all selector elements\r\n\t\tthis.each(function(){\r\n\t\t\t\r\n\t\t\t// pick single element from selection\r\n\t\t\tvar $this = $(this);\r\n\r\n\t\t\t/***************************/\r\n\r\n\t\t\t// Dispatch interaction event to socket server\r\n\t\t\tvar dispatchEvent = function(event, callback){\r\n\t\t\t\tsocketEmit(options.socket, {\r\n\t\t\t\t\tevent \t\t: \tevent,\r\n\t\t\t\t\tsessionId \t: \toptions.sessionId,\r\n\t\t\t\t\tpickData \t: \tgetPickData($this, options.pickData)\r\n\t\t\t\t}, callback);\r\n\t\t\t}\r\n\r\n\t\t\t// Dispatch interaction event to socket server in bulk\r\n\t\t\tvar dispatchBulkEvent = function(event, callback){\r\n\t\t\t\tinviewPending.push({\r\n\t\t\t\t\tsocket : options.socket,\r\n\t\t\t\t\tdata : {\r\n\t\t\t\t\t\tevent \t\t: \tevent,\r\n\t\t\t\t\t\tsessionId \t: \toptions.sessionId,\r\n\t\t\t\t\t\tpickData \t: \tgetPickData($this, options.pickData)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : callback\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// bind events to dom elements\r\n\t\t\tvar bindDomEvents = function(event, callback){\r\n\t\t\t\tif(event == 'ready'){\r\n\t\t\t\t\t$(document).ready(function(){\r\n\t\t\t\t\t\tcallback(event);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(options.once == true){\r\n\t\t\t\t\t\t$this.one(event, function(){\r\n\t\t\t\t\t\t\tcallback(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t$this.on(event, function(){\r\n\t\t\t\t\t\t\tcallback(event);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/***************************/\r\n\r\n\t\t\t// when user clicks on an element\r\n\t\t\tif(options.on == 'click'){\r\n\t\t\t\tbindDomEvents('click', function(event){\r\n\t\t\t\t\tdispatchEvent(event, function(data){\r\n\t\t\t\t\t\tif(options.callback) options.callback($this, data);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// when user enter mouse inside element\r\n\t\t\telse if(options.on == 'mouseenter'){\r\n\t\t\t\tbindDomEvents('mouseenter', function(event){\r\n\t\t\t\t\tdispatchEvent(event, function(data){\r\n\t\t\t\t\t\tif(options.callback) options.callback($this, data);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// when element is in view\r\n\t\t\telse if(options.on == 'inview'){\r\n\t\t\t\tbindDomEvents('inview', function(event){\r\n\t\t\t\t\tdispatchBulkEvent(event, function(data){\r\n\t\t\t\t\t\tif(options.callback) options.callback($this, data);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// when document is ready\r\n\t\t\telse if(options.on == 'ready'){\r\n\t\t\t\tbindDomEvents('ready', function(event){\r\n\t\t\t\t\tdispatchEvent(event, function(data){\r\n\t\t\t\t\t\tif(options.callback) options.callback($this, data);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// plugin default configurations\r\n\t// user can setup properties using `$.fn.pageReact.key`\r\n\t$.fn.pageReact.config = {\r\n\t\tsocket : null\r\n\t};\r\n\t$.fn.pageReactConfig = function(options){\r\n\t\t$.extend($.fn.pageReact.config, options);\r\n\t}\r\n\r\n})(jQuery);"]}